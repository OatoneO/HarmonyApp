/*
 * æˆ‘çš„é¡µé¢èœå•æ 
 * */
import router from '@ohos.router'
import promptAction from '@ohos.promptAction'
import { VideoInfoDataSource } from '../datasource/VideoInfoDataSource'
import { VideoInfo } from '../model/VideoInfo'

@Component
export struct MePageMenu{
  // è§†é¢‘æ•°æ®æº
  @Consume videoInfoDataSource: VideoInfoDataSource
  // è§†é¢‘ç¼–è¾‘çª—å£çš„å®ä¾‹åŒ–
  private controller: CustomDialogController
    = new CustomDialogController({
    builder: SearchDiaLog({

    }),
    alignment: DialogAlignment.Default
  });
  @State handlePopup: boolean = false
  build(){
    Row(){
      //Flexå¸ƒå±€ä¸»è½´æ–¹å‘å…ƒç´ ç­‰è·ç¦»å¸ƒå±€
      // ç»„ä»¶åœ¨ä¸»è½´æ–¹å‘ç»ˆç‚¹å¯¹é½
      // æœ€åä¸€ä¸ªå­ç»„ä»¶å’Œçˆ¶å…ƒç´ çš„è¾¹æ²¿å¯¹é½
      // å…¶ä»–å…ƒç´ ä¸å³ä¸€ä¸ªå…ƒç´ å¯¹é½
      Flex({justifyContent:FlexAlign.End}){
        // æœç´¢
        Image($r('app.media.ic_public_search'))
          .width(40)
          .height(40)
          .onClick(()=>{
            this.controller.open()
          })
        //é—´éš”
        Column().width(22)
        // èœå•
        Image($r('app.media.ic_public_view_list'))
          .width(40)
          .height(40)
          .bindMenu([
            {
              value:'ä¸ªäººè®¾ç½®',
              action: () => {
                this.handlePopup = !this.handlePopup
              }
            },
            {
            value:'é€€å‡ºè´¦å·',
              action: () => {
                router.replaceUrl({
                  url:'pages/RegisterPage'
                })
              }
            }
          ])
          .bindPopup(this.handlePopup, {
            message: 'æ–°åŠŸèƒ½æ­£åœ¨éª‘é©¬æ¥çš„è·¯ä¸ŠğŸ¥º',
            onStateChange: (e)=> {
              // è¿”å›å½“å‰çš„æ°”æ³¡çŠ¶æ€
              if (!e.isVisible) {
                this.handlePopup = false
              }
            }
          })
      }
    }.width('100%')
    .height(40)
  }
}

@CustomDialog
struct SearchDiaLog{
  // ç”±è°ƒç”¨æ–¹ä¼ é€’æä¾›æ§åˆ¶å™¨
  private controller: CustomDialogController;
  // æ¶ˆè´¹ç¥–å…ˆèŠ‚ç‚¹ä¸Šçš„æ•°æ®æº
  @Consume videoInfoDataSource: VideoInfoDataSource;
  // è§†é¢‘æ•°æ®
  @State searchVideoInfo: VideoInfo = new VideoInfo();

  build() {
    Column(){
      //è§†é¢‘å†…å®¹
      TextArea({
        placeholder: 'è¯·è¾“å…¥è¦æœç´¢çš„è§†é¢‘å†…å®¹',
      })
        .width(320)
        .height(80)
        .borderRadius(8)
        .backgroundColor('#F9F9F9')
        .margin({ top: 10 })
        .fontSize(20)
        .onChange((value:string)=>{
          this.searchVideoInfo.content = value
        })

      // æŒ‰é’®
      Flex({ justifyContent: FlexAlign.SpaceAround }) {
        Button('å–æ¶ˆ')
          .backgroundColor(Color.White)
          .fontColor(Color.Black)
          .onClick(() => {
            //å€ŸåŠ©æ§åˆ¶å™¨å®ç°å…³é—­çª—å£
            this.controller.close();
          })
        Button('ç¡®å®š')
          .backgroundColor(Color.White)
          .fontColor(Color.Red)
          .onClick(() => {
            let searchFlag = this.videoInfoDataSource.SearchDataByContent(this.searchVideoInfo.content)
            if (searchFlag) {
              promptAction.showToast({
                message: 'å­˜åœ¨è¯¥è§†é¢‘',
                duration: 2000
              })
            }else {
              promptAction.showToast({
                message: 'ä¸å­˜åœ¨è¯¥è§†é¢‘',
                duration: 2000
              })
            }
          })
      }
      .margin({ bottom: 10 })
    }

  }
}